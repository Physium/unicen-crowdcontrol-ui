"use strict";function operateFormatter(a,t,e){return searchChartData(t.batchId)?['<a data-toggle="modal" data-id="'+t.batchId+'" data-target="#resultsModal" class="like ml10" title="Results">','<i class="fa fa-bar-chart-o"></i>',"</a>",'<a data-toggle="modal" data-id="'+t.batchId+'" data-target="#statusModal" class="like ml10" title="Status">','<i class="fa fa-search"></i>',"</a>",'<a class="edit ml10 '+t.batchId+'" href="javascript:void(0)" title="Compare" style="display:none">','<i class="fa fa-plus"></i>',"</a>",'<a class="remove ml10 '+t.batchId+'" href="javascript:void(0)" title="Remove">','<i class="fa fa-minus"></i>',"</a>"].join(""):['<a data-toggle="modal" data-id="'+t.batchId+'" data-target="#resultsModal" class="like ml10" title="Results">','<i class="fa fa-bar-chart-o"></i>',"</a>",'<a data-toggle="modal" data-id="'+t.batchId+'" data-target="#statusModal" class="like ml10" title="Status">','<i class="fa fa-search"></i>',"</a>",'<a class="edit ml10 '+t.batchId+'" href="javascript:void(0)" title="Compare">','<i class="fa fa-plus"></i>',"</a>",'<a class="remove ml10 '+t.batchId+'" href="javascript:void(0)" title="Remove" style="display:none">','<i class="fa fa-minus"></i>',"</a>"].join("")}function progress(a){return console.log(a),'<div class="dashboard-stat2" style="background:none;padding:0;"><div class="progress-info"><div class="progress"><span style="width: '+a+'%;" class="progress-bar progress-bar-success green-sharp"><span class="sr-only">'+a+'% progress</span></span></div><div class="status"><div class="status-title"> progress </div><div class="status-number">'+a+"% </div></div></div></div>"}function responseHandler(a){console.log(a);for(var t=[],e=0;e<a.length;e++){var s={};s.batchId=a[e].batchId,s.runs=a[e].runs,s.progress=currentProgress(a[e].batch,a[e].runs),t.push(s)}return t}function drawChart(){data=new google.visualization.DataTable,data.addColumn("number","Percentile"),console.log(simChartData);for(var a=0;a<simChartData.length;a++)data.addColumn("number","ID "+simChartData[a].batchId);for(var t=[],a=0;a<simChartData[0].results.length;a++){var e=[];e.push(5*(a+1));for(var s=0;s<simChartData.length;s++)e.push(simChartData[s].results[a]);t.push(e)}data.addRows(t),options={title:"Evacuation Time of Crowd",vAxis:{title:"Evacuation Time (sec)"},hAxis:{title:"Percentile"},chartArea:{width:"50%"}},chart=new google.visualization.LineChart(document.getElementById("simulationEvacuationChart")),chart.draw(data,options)}google.charts.load("current",{packages:["line","corechart"]});var ipAddress="10.1.20.70:8080",urlStatus="http://"+ipAddress+"/SimulatorControl/?command=status",urlStart="http://"+ipAddress+"/SimulatorControl/?command=start",urlStop="http://"+ipAddress+"/SimulatorControl/?command=urlStop",urlData="http://"+ipAddress+"/SimulatorControl/?command=getPercentileData",urlSingleRunData="http://"+ipAddress+"/SimulatorControl/?command=getAllSingleRunData",urlBatchRunData="http://"+ipAddress+"/SimulatorControl/?command=getAllBatchRunData",urlGetAvailableInstance="http://"+ipAddress+"/SimulatorControl/?command=getAvailableInstance",urlGetProgressInstance="http://"+ipAddress+"/SimulatorControl/?command=getProgressInstance",batchRunData,singleRunData,simChartData=[];simChartData.push();var chart,data,options,getBatchRunDataInfo=function(a){for(var t=0;t<batchRunData.length;t++)if(batchRunData[t].batchId==a)return batchRunData[t].batch;return[]},getBatchData=function(a){for(var t=0;t<batchRunData.length;t++)if(batchRunData[t].batchId==a)return batchRunData[t];return[]},searchChartData=function(a){for(var t=0;t<simChartData.length;t++)if(simChartData[t].batchId==a)return console.log("found"),!0},updateTable=function(){$.get(urlBatchRunData,function(a){$("#table-result").bootstrapTable("load",{data:responseHandler(a)}),batchRunData=a})},averageResult=function(a){var t=[],e=JSON.parse(a[0].result);if(null!=e)for(var s=0;s<e.results.length;s++){for(var i=0,l=0;l<a.length;l++){var o=JSON.parse(a[l].result);null!=o&&(i+=o.results[s])}t.push(i/a.length)}return t},currentProgress=function a(t,e){var a=0;t.length;if(t.length>0)for(var s=0;s<t.length;s++)"FINISHED"==t[s].instanceState&&(a+=1);return Math.round(a/e*100)};$("#marco").click(function(){$("#batchRunParams").show(),$("#detail").show(),$("#marco").hide(),$("#singleRunParams").hide()}),$("#detail").click(function(){$("#batchRunParams").hide(),$("#detail").hide(),$("#marco").show(),$("#singleRunParams").show()}),$("#clearSimulator").click(function(){simChartData=[],$("#simulationEvacuationChart").html("<h1>No simulations results</h1>")}),$("#simulationSubmit").click(function(){var a=$("#building select").val(),t=$("#run input").val(),e=$("#agents input").val(),s=$("#location select").val(),i=$("#time input").val(),l=$("#crowd select").val(),o=$("#lift select").val(),n=$("#escalator select").val(),r=$("#access select").val(),c=$("#information select").val(),d=$("#path select").val(),h=$("#distribution select").val(),u=$("#disruption select").val(),v=$("#strategy select").val(),m={};if(m.run=parseInt(t),m.agents=parseInt(e),m.building=a,m.location=s,m.time=i,m.crowd=l,m.information=c,m.path=d,m.activatedLift=[],m.activatedEscalator=[],m.activatedAccess=[],$("#escalator option").each(function(){console.log($(this).val()),n?-1==n.indexOf($(this).val())&&m.activatedEscalator.push($(this).val()):m.activatedEscalator.push($(this).val())}),$("#lift option").each(function(){o?-1==o.indexOf($(this).val())&&m.activatedLift.push($(this).val()):m.activatedLift.push($(this).val())}),$("#access option").each(function(){r?-1==r.indexOf($(this).val())&&m.activatedAccess.push($(this).val()):m.activatedAccess.push($(this).val())}),$("#detail").is(":visible")){switch(m.information=h,u){case"AllGreen":$("#escalator option").each(function(){m.activatedEscalator.push($(this).val())}),$("#lift option").each(function(){m.activatedLift.push($(this).val())}),$("#access option").each(function(){m.activatedAccess.push($(this).val())});break;case"FullDisruption":m.activatedEscalator=[],m.activatedLift=[],m.activatedAccess=[];break;case"DoorWayDisrupted":m.activatedAccess=[],$("#escalator option").each(function(){m.activatedEscalator.push($(this).val())}),$("#lift option").each(function(){m.activatedLift.push($(this).val())});break;case"ElevatorsDisrupted":m.activatedLift=[],$("#escalator option").each(function(){m.activatedEscalator.push($(this).val())}),$("#access option").each(function(){m.activatedAccess.push($(this).val())});break;case"EscalatorsDisrupted":m.activatedEscalator=[],$("#lift option").each(function(){m.activatedLift.push($(this).val())}),$("#access option").each(function(){m.activatedAccess.push($(this).val())})}switch(v){case"PI-NB":m.information="PARTIAL",m.path="NAIVE";break;case"PI-AB":m.information="PARTIAL",m.path="ADAPTIVE";break;case"CI-NB":m.information="COMPLETE",m.path="NAIVE";break;case"CI-AB":m.information="COMPLETE",m.path="ADAPTIVE";break;case"PI-OT":m.information="PARTIAL",m.path="ONETIME"}}console.log(JSON.stringify(m));var f=JSON.stringify(m);$.ajax({method:"POST",url:urlStart,data:{config:f}}).done(function(a){console.log(a)}),updateTable()}),$.ajax({method:"GET",url:urlBatchRunData,async:!1}).done(function(a){$("#widgetResults").attr("data-value",a.length)}),$.ajax({method:"GET",url:urlGetProgressInstance,async:!1}).done(function(a){console.log(a),$("#widgetProgress").attr("data-value",a.length)}),$.ajax({method:"GET",url:urlGetAvailableInstance,async:!1}).done(function(a){$("#widgetAvailable").attr("data-value",a.length)}),$(document).ready(function(){$("#table-result").bootstrapTable(),updateTable(),setInterval(updateTable,5e3),$(".js-example-basic-single").select2(),$("#simulation").load("simulationEvacuationChart.html"),$("#batchRunParams").hide(),$("#detail").hide(),$("#resultsModal").on("show.bs.modal",function(a){function t(){var t=$(a.relatedTarget),e=t.data("id"),s=getBatchRunDataInfo(e);console.log(s);var i=new google.visualization.DataTable;i.addColumn("number","Percentile"),i.addColumn("number",e);var l=[];if(s.length>0){var o=averageResult(s);console.log(o);for(var n=0;n<o.length;n++){var r=[];r.push(5*(n+1)),r.push(o[n]),l.push(r)}i.addRows(l)}var c={title:"Evacuation Time of Crowd",width:"100%",height:"400",legend:"none",vAxis:{title:"Evacuation Time (sec)"},hAxis:{title:"Percentile"},chartArea:{left:"25%"}},d=new google.visualization.LineChart(document.getElementById("resultsModalChart"));d.draw(i,c)}google.charts.setOnLoadCallback(t)}),$("#statusModal").on("show.bs.modal",function(a){console.log("status");var t=$(a.relatedTarget),e=t.data("id"),s=getBatchData(e),i=$(this),l=s.runs,o=s.batch;console.log(s),i.find(".modal-body").html("<table id='instanceTable' style='table-layout:fixed' class='table table-bordered'><tr><th>Job ID</th><th>Instance State</th></tr></table>");for(var n=0;l>n;n++)if(o[n]){var r=(o[n].jobId,o[n].instanceId,o[n].instanceState);i.find("#instanceTable").append("<tr><td>"+(n+1)+"</td><<td>"+r+"</td></tr>")}else i.find("#instanceTable").append("<tr><td>"+(n+1)+"</td><<td>QUEUE</td></tr>")})}),window.operateEvents={"click .like":function(a,t,e,s){console.log(t,e,s)},"click .edit":function(a,t,e,s){console.log(e.batchId);var i=e.batchId;$(this).hide(),$(".remove."+i).show();for(var l=0;l<batchRunData.length;l++)if(batchRunData[l].batchId==i){var o=getBatchRunDataInfo(batchRunData[l].batchId),n=averageResult(o);o.results=n,o.batchId=batchRunData[l].batchId,simChartData.push(o),console.log(o)}console.log(simChartData),drawChart()},"click .remove":function(a,t,e,s){console.log(e.batchId);var i=e.batchId;$(this).hide(),$(".edit."+i).show();for(var l=0;l<simChartData.length;l++)if(simChartData[l].batchId==i){console.log("remove"),simChartData.splice(l,1);break}simChartData.length>0?drawChart():$("#simulationEvacuationChart").html("<h1>No simulations results</h1>")}};