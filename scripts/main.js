"use strict";function operateFormatter(a,t,e){return['<a data-toggle="modal" data-id="'+t.batchId+'" data-target="#resultsModal" class="like ml10" title="Results">','<i class="fa fa-bar-chart-o"></i>',"</a>",'<a data-toggle="modal" data-id="'+t.batchId+'" data-target="#myModal" class="like ml10" title="Results">','<i class="fa fa-search"></i>',"</a>",'<a class="edit ml10 '+t.batchId+'" href="javascript:void(0)" title="Compare">','<i class="fa fa-plus"></i>',"</a>",'<a class="remove ml10 '+t.batchId+'" href="javascript:void(0)" title="Remove" style="display:none">','<i class="fa fa-minus"></i>',"</a>"].join("")}function progress(a){return console.log(a),'<div class="dashboard-stat2" style="background:none;padding:0;"><div class="progress-info"><div class="progress"><span style="width: '+a+'%;" class="progress-bar progress-bar-success green-sharp"><span class="sr-only">'+a+'% progress</span></span></div><div class="status"><div class="status-title"> progress </div><div class="status-number">'+a+"% </div></div></div></div>"}function responseHandler(a){console.log(a);for(var t=[],e=0;e<a.length;e++){var s={};s.batchId=a[e].batchId,s.runs=a[e].runs,s.progress=currentProgress(a[e].batch,a[e].runs),t.push(s)}return t}function drawChart(){data=new google.visualization.DataTable,data.addColumn("number","Percentile"),console.log(simChartData);for(var a=0;a<simChartData.length;a++)data.addColumn("number","ID "+simChartData[a].batchId);for(var t=[],a=0;a<simChartData[0].results.length;a++){var e=[];e.push(5*(a+1));for(var s=0;s<simChartData.length;s++)e.push(simChartData[s].results[a]);t.push(e)}data.addRows(t),options={title:"Evacuation Time of Crowd",vAxis:{title:"Evacuation Time (sec)"},hAxis:{title:"Percentile"},chartArea:{width:"50%"}},chart=new google.visualization.LineChart(document.getElementById("simulationEvacuationChart")),chart.draw(data,options)}google.charts.load("current",{packages:["line","corechart"]});var ipAddress="10.1.20.70:8080",urlStatus="http://"+ipAddress+"/SimulatorControl/?command=status",urlStart="http://"+ipAddress+"/SimulatorControl/?command=start",urlStop="http://"+ipAddress+"/SimulatorControl/?command=urlStop",urlData="http://"+ipAddress+"/SimulatorControl/?command=getPercentileData",urlSingleRunData="http://"+ipAddress+"/SimulatorControl/?command=getAllSingleRunData",urlBatchRunData="http://"+ipAddress+"/SimulatorControl/?command=getAllBatchRunData",batchRunData,singleRunData,simChartData=[];simChartData.push();var chart,data,options,getBatchRunDataInfo=function(a){for(var t=0;t<batchRunData.length;t++)if(batchRunData[t].batchId==a)return batchRunData[t].batch;return[]},getBatchData=function(a){for(var t=0;t<batchRunData.length;t++)if(batchRunData[t].batchId==a)return batchRunData[t];return[]},getSingleRunDataInfo=function(a){for(var t=0;t<singleRunData.length;t++)if(singleRunData[t].jobId==a)return singleRunData[t];return[]};$("#marco").click(function(){$("#batchRunParams").show(),$("#detail").show(),$("#marco").hide(),$("#singleRunParams").hide()}),$("#detail").click(function(){$("#batchRunParams").hide(),$("#detail").hide(),$("#marco").show(),$("#singleRunParams").show()}),$("#simulationSubmit").click(function(){var a=$("#building select").val(),t=$("#run input").val(),e=$("#agents input").val(),s=$("#location select").val(),i=$("#time input").val(),n=$("#crowd select").val(),o=$("#lift select").val(),l=$("#escalator select").val(),r=$("#access select").val(),c=$("#information select").val(),h=$("#path select").val(),u=$("#distribution select").val(),d=$("#disruption select").val(),v=$("#strategy select").val(),p={};if(console.log(JSON.stringify(p)),p.run=parseInt(t),p.agents=parseInt(e),p.building=a,p.location=s,p.time=i,p.crowd=n,p.information=c,p.path=h,p.activatedLift=[],p.activatedEscalator=[],p.activatedAccess=[],$("#escalator option").each(function(){console.log($(this).val()),l?-1==l.indexOf($(this).val())&&p.activatedEscalator.push($(this).val()):p.activatedEscalator.push($(this).val())}),$("#lift option").each(function(){o?-1==o.indexOf($(this).val())&&p.activatedLift.push($(this).val()):p.activatedLift.push($(this).val())}),$("#access option").each(function(){r?-1==r.indexOf($(this).val())&&p.activatedAccess.push($(this).val()):p.activatedAccess.push($(this).val())}),console.log($("#detail").is(":visible")),$("#detail").is(":visible")){switch(p.information=u,d){case"AllGreen":$("#escalator option").each(function(){p.activatedEscalator.push($(this).val())}),$("#lift option").each(function(){p.activatedLift.push($(this).val())}),$("#access option").each(function(){p.activatedAccess.push($(this).val())});break;case"FullDisruption":p.activatedEscalator=[],p.activatedLift=[],p.activatedAccess=[];break;case"DoorWayDisrupted":p.activatedAccess=[],$("#escalator option").each(function(){p.activatedEscalator.push($(this).val())}),$("#lift option").each(function(){p.activatedLift.push($(this).val())});break;case"ElevatorsDisrupted":p.activatedLift=[],$("#escalator option").each(function(){p.activatedEscalator.push($(this).val())}),$("#access option").each(function(){p.activatedAccess.push($(this).val())});break;case"EscalatorsDisrupted":p.activatedEscalator=[],$("#lift option").each(function(){p.activatedLift.push($(this).val())}),$("#access option").each(function(){p.activatedAccess.push($(this).val())})}switch(v){case"PI-NB":p.information="PARTIAL",p.path="NAIVE";break;case"PI-AB":p.information="PARTIAL",p.path="ADAPTIVE";break;case"CI-NB":p.information="COMPLETE",p.path="NAIVE";break;case"CI-AB":p.information="COMPLETE",p.path="ADAPTIVE";break;case"PI-OT":p.information="PARTIAL",p.path="ONETIME"}}console.log(JSON.stringify(p));var f=JSON.stringify(p);$.ajax({method:"POST",url:urlStart,data:{config:f}}).done(function(a){console.log(a)}),updateTable()});var updateTable=function(){$.get(urlBatchRunData,function(a){$("#table-result").bootstrapTable("load",{data:responseHandler(a)}),batchRunData=a})},averageResult=function(a){var t=[],e=JSON.parse(a[0].result);if(null!=e)for(var s=0;s<e.results.length;s++){for(var i=0,n=0;n<a.length;n++){var o=JSON.parse(a[n].result);null!=o&&(i+=o.results[s])}t.push(i/a.length)}return t};$(document).ready(function(){var a=$("#table-result");$.get(urlBatchRunData,function(t){a.bootstrapTable({data:responseHandler(t)}),batchRunData=t}),$(".js-example-basic-single").select2(),$("#simulation").load("simulationEvacuationChart.html"),$("#batchRunParams").hide(),$("#detail").hide();setInterval(updateTable,5e3),$("#resultsModal").on("show.bs.modal",function(a){function t(){var t=$(a.relatedTarget),e=t.data("id"),s=getBatchRunDataInfo(e);console.log(s);var i=averageResult(s);console.log(i);var n=new google.visualization.DataTable;n.addColumn("number","Percentile"),n.addColumn("number",e);for(var o=[],l=0;l<i.length;l++){var r=[];r.push(5*(l+1)),r.push(i[l]),o.push(r)}n.addRows(o);var c={title:"Evacuation Time of Crowd",width:"100%",height:"400",legend:"none",vAxis:{title:"Evacuation Time (sec)"},hAxis:{title:"Percentile"},chartArea:{left:"25%"}},h=new google.visualization.LineChart(document.getElementById("resultsModalChart"));h.draw(n,c)}google.charts.setOnLoadCallback(t)}),$("#myModal").on("show.bs.modal",function(a){var t=$(a.relatedTarget),e=t.data("id"),s=getBatchData(e),i=$(this),n=s.runs,o=s.batch;console.log("test"),console.log(s),i.find(".modal-body").html("<table id='instanceTable' style='table-layout:fixed' class='table table-bordered'><tr><th>Job ID</th><th>Instance State</th></tr></table>");for(var l=0;n>l;l++)if(o[l]){var r=(o[l].jobId,o[l].instanceId,o[l].instanceState);i.find("#instanceTable").append("<tr><td>"+(l+1)+"</td><<td>"+r+"</td></tr>")}else i.find("#instanceTable").append("<tr><td>"+(l+1)+"</td><<td>QUEUE</td></tr>")})});var currentProgress=function a(t,e){var a=0;t.length;if(t.length>0)for(var s=0;s<t.length;s++)"FINISHED"==t[s].instanceState&&(a+=1);return a/e*100};window.operateEvents={"click .like":function(a,t,e,s){console.log(t,e,s)},"click .edit":function(a,t,e,s){console.log(e.batchId);var i=e.batchId;$(this).hide(),$(".remove."+i).show();for(var n=0;n<batchRunData.length;n++)if(batchRunData[n].batchId==i){var o=getBatchRunDataInfo(batchRunData[n].batchId),l=averageResult(o);o.results=l,o.batchId=batchRunData[n].batchId,simChartData.push(o),console.log(o)}console.log(simChartData),drawChart()},"click .remove":function(a,t,e,s){console.log(e.batchId);var i=e.batchId;$(this).hide(),$(".edit."+i).show();for(var n=0;n<simChartData.length;n++)if(simChartData[n].batchId==i){console.log("remove"),simChartData.splice(n,1);break}simChartData.length>0?drawChart():$("#simulationEvacuationChart").html("<h1>No simulations results</h1>")}},$("#clearSimulator").click(function(){simChartData=[],$("#simulationEvacuationChart").html("<h1>No simulations results</h1>")});